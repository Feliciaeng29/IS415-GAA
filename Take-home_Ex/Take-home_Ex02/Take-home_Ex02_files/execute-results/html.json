{
  "hash": "ca6b437fc34d976634faa8cf1c0d7e23",
  "result": {
    "markdown": "---\ntitle: \"Take-home Exercise 2: Application of Spatial and Spatio-temporal Analysis Methods to Discover the Distribution of Dengue Fever in Tainan City, Taiwan\"\nauthor:\n  - name: Felicia Eng\ndate: \"February 2024\"\ndate-modified: \"2024-03-04\"\nexecute: \n  echo: true\n  eval: true\n  warning: false\neditor: visual\n---\n\n\n## **The Task**\n\nThe specific tasks of this take-home exercise are as follows:\n\n-   Using appropriate function of **sf** and **tidyverse**, preparing the following geospatial data layer:\n\n    -   a study area layer in sf polygon features. It must be at village level and confined to the D01, D02, D04, D06, D07, D08, D32 and D39 counties of Tainan City, Taiwan.\n\n    -   a dengue fever layer within the study area in sf point features. The dengue fever cases should be confined to epidemiology week 31-50, 2023.\n\n    -   a derived dengue fever layer in [spacetime s3 class of sfdep](https://sfdep.josiahparry.com/articles/spacetime-s3). It should contain, among many other useful information, a data field showing number of dengue fever cases by village and by epidemiology week.\n\n-   Using the extracted data, perform global spatial autocorrelation analysis by using [sfdep methods](https://is415-gaa-tskam.netlify.app/in-class_ex/in-class_ex05/in-class_ex05-glsa).\n\n-   Using the extracted data, perform local spatial autocorrelation analysis by using [sfdep methods](https://r4gdsa.netlify.app/chap10.html).\n\n-   Using the extracted data, perform emerging hotspot analysis by using [sfdep methods](https://is415-gaa-tskam.netlify.app/in-class_ex/in-class_ex05/in-class_ex05-ehsa).\n\n-   Describe the spatial patterns revealed by the analysis above.\n\n# **Importing Packages**\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, st, tidyverse, lubridate, spdep, tmap, knitr, ggplot2, smoothr, sfdep, lubridate, RColorBrewer, plotly)\n```\n:::\n\n\n# \\*Importing Datasets to R Environment\\*\\*\n\n## *Tainan Dataset*\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntainan <- st_read(dsn = \"data/geospatial\", \n                 layer = \"TAINAN_VILLAGE\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `TAINAN_VILLAGE' from data source \n  `C:\\Feliciaeng29\\IS415-GAA\\Take-home_Ex\\Take-home_Ex02\\data\\geospatial' \n  using driver `ESRI Shapefile'\nSimple feature collection with 649 features and 10 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 120.0269 ymin: 22.88751 xmax: 120.6563 ymax: 23.41374\nGeodetic CRS:  TWD97\n```\n:::\n\n```{.r .cell-code}\nhead(tainan, 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 5 features and 10 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 120.053 ymin: 22.93251 xmax: 120.2905 ymax: 23.14345\nGeodetic CRS:  TWD97\n     VILLCODE COUNTYNAME TOWNNAME VILLNAME       VILLENG COUNTYID COUNTYCODE\n1 67000280002     臺南市   歸仁區   六甲里   Liujia Vil.        D      67000\n2 67000350032     臺南市   安南區   青草里  Qingcao Vil.        D      67000\n3 67000150009     臺南市   七股區   溪南里    Xinan Vil.        D      67000\n4 67000150010     臺南市   七股區   七股里     Qigu Vil.        D      67000\n5 67000150008     臺南市   七股區   龍山里 Longshan Vil.        D      67000\n  TOWNID TOWNCODE NOTE                       geometry\n1    D33 67000280 <NA> POLYGON ((120.2725 22.95868...\n2    D06 67000350 <NA> POLYGON ((120.1176 23.08387...\n3    D22 67000150 <NA> POLYGON ((120.121 23.1355, ...\n4    D22 67000150 <NA> POLYGON ((120.1312 23.1371,...\n5    D22 67000150 <NA> POLYGON ((120.0845 23.13503...\n```\n:::\n:::\n\n\nLet's visualise the dataset that was just imported\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(tainan)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nIn this case, st_transform(tainan, CRS=3414) is not needed\n\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(tainan)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCoordinate Reference System:\n  User input: TWD97 \n  wkt:\nGEOGCRS[\"TWD97\",\n    DATUM[\"Taiwan Datum 1997\",\n        ELLIPSOID[\"GRS 1980\",6378137,298.257222101,\n            LENGTHUNIT[\"metre\",1]]],\n    PRIMEM[\"Greenwich\",0,\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\n    CS[ellipsoidal,2],\n        AXIS[\"geodetic latitude (Lat)\",north,\n            ORDER[1],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n        AXIS[\"geodetic longitude (Lon)\",east,\n            ORDER[2],\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\n    USAGE[\n        SCOPE[\"Horizontal component of 3D system.\"],\n        AREA[\"Taiwan, Republic of China - onshore and offshore - Taiwan Island, Penghu (Pescadores) Islands.\"],\n        BBOX[17.36,114.32,26.96,123.61]],\n    ID[\"EPSG\",3824]]\n```\n:::\n:::\n\n\n## *Dengue Dataset*\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue <- read_csv(\"data/aspatial/Dengue_Daily.csv\")\ndengue\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 106,861 × 26\n   發病日     個案研判日 通報日     性別  年齡層 居住縣市 居住鄉鎮 居住村里\n   <date>     <chr>      <date>     <chr> <chr>  <chr>    <chr>    <chr>   \n 1 1998-01-02 None       1998-01-07 男    40-44  屏東縣   屏東市   None    \n 2 1998-01-03 None       1998-01-14 男    30-34  屏東縣   東港鎮   None    \n 3 1998-01-13 None       1998-02-18 男    55-59  宜蘭縣   宜蘭市   None    \n 4 1998-01-15 None       1998-01-23 男    35-39  高雄市   苓雅區   None    \n 5 1998-01-20 None       1998-02-04 男    55-59  宜蘭縣   五結鄉   None    \n 6 1998-01-22 None       1998-02-19 男    20-24  桃園市   蘆竹區   None    \n 7 1998-01-23 None       1998-02-02 男    40-44  新北市   新店區   None    \n 8 1998-01-26 None       1998-02-19 女    65-69  台北市   北投區   None    \n 9 1998-02-11 None       1998-02-13 女    25-29  台南市   南區     None    \n10 1998-02-16 None       1998-02-24 男    20-24  高雄市   楠梓區   None    \n# ℹ 106,851 more rows\n# ℹ 18 more variables: 最小統計區 <chr>, 最小統計區中心點X <chr>,\n#   最小統計區中心點Y <chr>, 一級統計區 <chr>, 二級統計區 <chr>,\n#   感染縣市 <chr>, 感染鄉鎮 <chr>, 感染村里 <chr>, 是否境外移入 <chr>,\n#   感染國家 <chr>, 確定病例數 <dbl>, 居住村里代碼 <chr>, 感染村里代碼 <chr>,\n#   血清型 <chr>, 內政部居住縣市代碼 <chr>, 內政部居住鄉鎮代碼 <chr>,\n#   內政部感染縣市代碼 <chr>, 內政部感染鄉鎮代碼 <chr>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(dengue)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     發病日            個案研判日            通報日          \n Min.   :1998-01-02   Length:106861      Min.   :1998-01-07  \n 1st Qu.:2014-10-28   Class :character   1st Qu.:2014-10-31  \n Median :2015-09-29   Mode  :character   Median :2015-10-01  \n Mean   :2016-03-31                      Mean   :2016-04-03  \n 3rd Qu.:2023-06-19                      3rd Qu.:2023-06-23  \n Max.   :2024-01-29                      Max.   :2024-01-29  \n     性別              年齡層            居住縣市           居住鄉鎮        \n Length:106861      Length:106861      Length:106861      Length:106861     \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n   居住村里          最小統計區        最小統計區中心點X  最小統計區中心點Y \n Length:106861      Length:106861      Length:106861      Length:106861     \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n  一級統計區         二級統計區          感染縣市           感染鄉鎮        \n Length:106861      Length:106861      Length:106861      Length:106861     \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n   感染村里         是否境外移入         感染國家           確定病例數\n Length:106861      Length:106861      Length:106861      Min.   :1   \n Class :character   Class :character   Class :character   1st Qu.:1   \n Mode  :character   Mode  :character   Mode  :character   Median :1   \n                                                          Mean   :1   \n                                                          3rd Qu.:1   \n                                                          Max.   :2   \n 居住村里代碼       感染村里代碼          血清型          內政部居住縣市代碼\n Length:106861      Length:106861      Length:106861      Length:106861     \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n 內政部居住鄉鎮代碼 內政部感染縣市代碼 內政部感染鄉鎮代碼\n Length:106861      Length:106861      Length:106861     \n Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character  \n                                                         \n                                                         \n                                                         \n```\n:::\n:::\n\n\n# Data Preprocessing\n\n## Dengue Dataset\n\nAs stated a dengue fever layer within the study area in sf point features. The dengue fever cases should be confined to epidemiology week 31-50, 2023.\n\nConvert the date column to Date format\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue$發病日 <- as.Date(dengue$發病日)\n```\n:::\n\n\nExtract epidemiology week numbers from the onset date column\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue$epi_week_number <- as.numeric(format(dengue$發病日, \"%V\"))\n```\n:::\n\n\nDefine the desired epidemiology week range\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstart_epi_week <- 31\nend_epi_week <- 50\n```\n:::\n\n\nDefine the year of interest\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudy_year <- 2023\n```\n:::\n\n\nFilter rows based on the specified epidemiology week range and study year\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudy_dengue_cases <- dengue %>%\n  filter(epi_week_number >= start_epi_week & \n         epi_week_number <= end_epi_week & \n         year(發病日) == study_year)\n```\n:::\n\n\nCheck the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(study_dengue_cases)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     發病日            個案研判日            通報日          \n Min.   :2023-07-31   Length:25480       Min.   :2023-07-31  \n 1st Qu.:2023-09-11   Class :character   1st Qu.:2023-09-13  \n Median :2023-10-01   Mode  :character   Median :2023-10-03  \n Mean   :2023-10-03                      Mean   :2023-10-05  \n 3rd Qu.:2023-10-26                      3rd Qu.:2023-10-27  \n Max.   :2023-12-17                      Max.   :2023-12-23  \n     性別              年齡層            居住縣市           居住鄉鎮        \n Length:25480       Length:25480       Length:25480       Length:25480      \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n   居住村里          最小統計區        最小統計區中心點X  最小統計區中心點Y \n Length:25480       Length:25480       Length:25480       Length:25480      \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n  一級統計區         二級統計區          感染縣市           感染鄉鎮        \n Length:25480       Length:25480       Length:25480       Length:25480      \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n   感染村里         是否境外移入         感染國家           確定病例數\n Length:25480       Length:25480       Length:25480       Min.   :1   \n Class :character   Class :character   Class :character   1st Qu.:1   \n Mode  :character   Mode  :character   Mode  :character   Median :1   \n                                                          Mean   :1   \n                                                          3rd Qu.:1   \n                                                          Max.   :1   \n 居住村里代碼       感染村里代碼          血清型          內政部居住縣市代碼\n Length:25480       Length:25480       Length:25480       Length:25480      \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n 內政部居住鄉鎮代碼 內政部感染縣市代碼 內政部感染鄉鎮代碼 epi_week_number\n Length:25480       Length:25480       Length:25480       Min.   :31.00  \n Class :character   Class :character   Class :character   1st Qu.:37.00  \n Mode  :character   Mode  :character   Mode  :character   Median :39.00  \n                                                          Mean   :39.84  \n                                                          3rd Qu.:43.00  \n                                                          Max.   :50.00  \n```\n:::\n:::\n\n\nSelect and rename columns\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue <- study_dengue_cases %>%\n  rename('x' = 最小統計區中心點X,\n         'y' = 最小統計區中心點Y,\n         'COUNTYNAME' = 居住縣市,\n         'VILLNAME' = 居住村里,\n         'TOWNNAME' = 居住鄉鎮)\n```\n:::\n\n\nCheck the form of x and y coordinates\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(dengue$`x`)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"character\"\n```\n:::\n\n```{.r .cell-code}\nclass(dengue$`y`)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"character\"\n```\n:::\n:::\n\n\nChanging it to numerical for x and y coords\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue$`x` <- as.numeric(dengue$`x`)\ndengue$`y` <- as.numeric(dengue$`y`)\n```\n:::\n\n\nAs it can be seen: Warning: NAs introduced by coercionWarning: NAs introduced by coercion\n\nLets remove the NA values from all the columns\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue <- na.omit(dengue)\n```\n:::\n\n\nDouble check the data before moving on\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(dengue$`x`)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"numeric\"\n```\n:::\n\n```{.r .cell-code}\nclass(dengue$`y`)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"numeric\"\n```\n:::\n:::\n\n\nConvert to an sf object with POINT geometry\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfiltered_dengue <- st_as_sf(dengue, coords = c('x', 'y'), crs = st_crs(tainan))\n```\n:::\n\n\nRemove missing values\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue <- dengue[!(dengue$VILLNAME == \"None\"), ]\n```\n:::\n\n\nGroup by village and calculate the number of dengue cases\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue_grouped <- dengue %>%\n  group_by(TOWNNAME, VILLNAME, epi_week_number) %>%\n  summarise(dengueCases = sum(確定病例數), .groups = 'drop')\n```\n:::\n\n\n## Tainan Dataset\n\nAs stated: a study area layer in sf polygon features. It must be at village level and confined to the D01, D02, D04, D06, D07, D08, D32 and D39 counties of Tainan City, Taiwan.\n\nRetrieve D01, D02, D04, D06, D07, D08, D32 and D39 counties of Tainan City, Taiwan.\n\nSo lets use the TOWNID to filter out only the specified countries. In this case we can also use subset(select = -NOTE) to exclude it from the dataframe.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntainan <- tainan[tainan$TOWNID %in% c(\"D01\", \"D02\", \"D04\", \"D06\", \"D07\", \"D08\", \"D32\", \"D39\"), ]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(tainan)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 6 features and 10 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 120.0936 ymin: 22.9156 xmax: 120.2585 ymax: 23.08827\nGeodetic CRS:  TWD97\n      VILLCODE COUNTYNAME TOWNNAME VILLNAME       VILLENG COUNTYID COUNTYCODE\n2  67000350032     臺南市   安南區   青草里  Qingcao Vil.        D      67000\n18 67000270011     臺南市   仁德區   保安里   Bao'an Vil.        D      67000\n66 67000370005     臺南市   中西區   赤嵌里  Chihkan Vil.        D      67000\n67 67000330004     臺南市     南區   大成里  Dacheng Vil.        D      67000\n68 67000350028     臺南市   安南區   城北里 Chengbei Vil.        D      67000\n69 67000350030     臺南市   安南區   城南里 Chengnan Vil.        D      67000\n   TOWNID TOWNCODE NOTE                       geometry\n2     D06 67000350 <NA> POLYGON ((120.1176 23.08387...\n18    D32 67000270 <NA> POLYGON ((120.2304 22.93544...\n66    D08 67000370 <NA> POLYGON ((120.2012 22.99966...\n67    D02 67000330 <NA> POLYGON ((120.1985 22.98147...\n68    D06 67000350 <NA> POLYGON ((120.1292 23.06512...\n69    D06 67000350 <NA> POLYGON ((120.1246 23.06904...\n```\n:::\n:::\n\n\nLets plot to visualise\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode('plot')\ntm_shape(tainan) + \n  tm_polygons(\"TOWNID\") \n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nunion_tainan <- st_union(tainan)\nplot(union_tainan)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n## Visualizing 2 datasets together\n\nVisualizing the distribution of dengue cases on the tainan map\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(tainan) + \n  tm_polygons(\"TOWNID\") +\ntm_shape(filtered_dengue) +\n  tm_dots(col = \"purple\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\nCombining both data frame into one\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue_in_tainan <- left_join(tainan, dengue_grouped, by = c(\"TOWNNAME\",\"VILLNAME\"))\n```\n:::\n\n\n# Visualizing Choropleth Map\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define a new color palette\ncolorRamp <- brewer.pal(n = 5, name = \"YlGnBu\")\ncolorRamp <- rev(colorRamp)\n\n# Fill missing values (NA) with 0\ndengue_in_tainan$dengueCases[is.na(dengue_in_tainan$dengueCases)] <- 0\n\n# Function to plot for a given month\nplot_for_month <- function(data, month, week_start, week_end) {\n  month_data <- data %>%\n    filter(epi_week_number >= week_start & epi_week_number <= week_end)\n  \n  tmap_mode(\"plot\")\n  tm_shape(month_data) +\n    tm_fill(\"dengueCases\",\n            style = \"quantile\",\n            palette = colorRamp,\n            title = \"Dengue Cases\") +\n    tm_layout(main.title = paste(month, \"2023 Distribution of Dengue Cases\"),\n              main.title.position = \"center\",\n              main.title.size = 1.0,\n              legend.height = 0.55,\n              legend.width = 0.55,\n              frame = TRUE) +\n    tm_borders(alpha = 0.5) +\n    tm_compass(type = \"8star\", size = 3) +\n    tm_scale_bar() +\n    tm_grid(alpha = 0.2)\n}\n\n# Plot for each month\nplot_for_month(dengue_in_tainan, \"August\", 31, 35)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot_for_month(dengue_in_tainan, \"September\", 36, 39)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-28-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplot_for_month(dengue_in_tainan, \"October\", 40, 44)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-28-3.png){width=672}\n:::\n\n```{.r .cell-code}\nplot_for_month(dengue_in_tainan, \"November\", 45, 48)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-28-4.png){width=672}\n:::\n:::\n\n\n# Global Spatial Autocorrelation\n\nContiguity weights: Queen’s method\n\nWe compute spatial contiguity relationships among geometries stored in a data frame, calculates spatial weights based on these relationships,and adds the resulting variables to the data frame.\n\nGrouping data by village name and summarizing dengue cases\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue_grouped <- dengue %>%\n  group_by(VILLNAME) %>%\n  summarise(DengueCases = sum(確定病例數))\n```\n:::\n\n\nRemoving rows with 'None' as village name\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue_grouped <- dengue_grouped[!(dengue_grouped$VILLNAME == \"None\"), ]\n```\n:::\n\n\nJoining the filtered Tainan data with the grouped dengue data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Perform the join\ntainan_dengue <- left_join(tainan, dengue_grouped, by = \"VILLNAME\")\n```\n:::\n\n\nReplacing NA values in DengueCases with 0\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntainan_dengue$DengueCases[is.na(tainan_dengue$DengueCases)] <- 0\n```\n:::\n\n\nCalculating spatial weights\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspatial_weights <- tainan_dengue %>%\n  mutate(Neighbors = st_contiguity(geometry, queen=TRUE),\n         Weights = st_weights(Neighbors, style = \"W\"),\n         .before = 1)\n```\n:::\n\n\nExamining the contents of the spatial weights matrix\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(spatial_weights)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 258\nColumns: 14\n$ Neighbors   <nb> <6, 118, 160>, <126, 128, 138, 168, 222>, <68, 69, 172, 181…\n$ Weights     <list> <0.3333333, 0.3333333, 0.3333333>, <0.2, 0.2, 0.2, 0.2, 0…\n$ VILLCODE    <chr> \"67000350032\", \"67000270011\", \"67000370005\", \"67000330004\"…\n$ COUNTYNAME  <chr> \"臺南市\", \"臺南市\", \"臺南市\", \"臺南市\", \"臺南市\", \"臺南市\"…\n$ TOWNNAME    <chr> \"安南區\", \"仁德區\", \"中西區\", \"南區\", \"安南區\", \"安南區\", …\n$ VILLNAME    <chr> \"青草里\", \"保安里\", \"赤嵌里\", \"大成里\", \"城北里\", \"城南里\"…\n$ VILLENG     <chr> \"Qingcao Vil.\", \"Bao'an Vil.\", \"Chihkan Vil.\", \"Dacheng Vi…\n$ COUNTYID    <chr> \"D\", \"D\", \"D\", \"D\", \"D\", \"D\", \"D\", \"D\", \"D\", \"D\", \"D\", \"D\"…\n$ COUNTYCODE  <chr> \"67000\", \"67000\", \"67000\", \"67000\", \"67000\", \"67000\", \"670…\n$ TOWNID      <chr> \"D06\", \"D32\", \"D08\", \"D02\", \"D06\", \"D06\", \"D08\", \"D06\", \"D…\n$ TOWNCODE    <chr> \"67000350\", \"67000270\", \"67000370\", \"67000330\", \"67000350\"…\n$ NOTE        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…\n$ DengueCases <dbl> 2, 33, 111, 29, 6, 13, 37, 48, 108, 66, 26, 2, 5, 11, 24, …\n$ geometry    <POLYGON [°]> POLYGON ((120.1176 23.08387..., POLYGON ((120.2304…\n```\n:::\n:::\n\n\n## Computing Global Moran’s I\n\nCalculate Global Moran's I\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmoranI_result <- global_moran(spatial_weights$DengueCases,\n                              spatial_weights$Neighbors,\n                              spatial_weights$Weights)\n```\n:::\n\n\nPrint the result\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(moranI_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nList of 2\n $ I: num 0.397\n $ K: num 4.83\n```\n:::\n:::\n\n\n## Performing Global Moran’s I test\n\nPerform the Moran's I test\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_test(spatial_weights$DengueCases,\n                  spatial_weights$Neighbors,\n                  spatial_weights$Weights)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tMoran I test under randomisation\n\ndata:  x  \nweights: listw    \n\nMoran I statistic standard deviate = 10.902, p-value < 2.2e-16\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.396838835      -0.003891051       0.001351108 \n```\n:::\n:::\n\n\nPerforming Global Moran’s I permutation test\n\nSet seed for reproducibility\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\n```\n:::\n\n\nPerform Monte Carlo simulation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglobal_moran_perm(spatial_weights$DengueCases,\n                  spatial_weights$Neighbors,\n                  spatial_weights$Weights,\n                  nsim = 99)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tMonte-Carlo simulation of Moran I\n\ndata:  x \nweights: listw  \nnumber of simulations + 1: 100 \n\nstatistic = 0.39684, observed rank = 100, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n:::\n:::\n\n\nThe results of your Monte Carlo simulation are given as a list with two values: **`I`** and **`K`**.\n\n-   **`I`** is the Moran’s I statistic, which measures spatial autocorrelation. A positive Moran’s I value (like 0.397 in your case) indicates positive spatial autocorrelation, which means that similar values tend to be located near each other. In the context of your analysis, this suggests that dengue cases are not randomly distributed across counties, but rather, counties with similar numbers of dengue cases tend to be located near each other.\n\n-   **`K`** is likely the test statistic for the permutation test, although without more context it’s hard to say for sure. In general, the permutation test is used to determine the significance of the Moran’s I statistic by comparing it to a distribution of Moran’s I values obtained by randomly permuting the spatial locations of the data.\n\nThe above statistical analysis reveals a p-value less than the alpha threshold of 0.05. This provides substantial evidence to dismiss the null hypothesis, which suggests that the spatial distribution of dengue cases across counties is random and spatially independent. Given that the Moran’s I statistic exceeds 0, it’s reasonable to conclude that there’s a tendency for clustering in the spatial distribution of dengue cases.\n\n\n# Local Spatial Autocorrelation Analysis\n\nComputing local Moran’s I\n\nCompute local Moran's I statistic for spatial autocorrelation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa <- spatial_weights %>% \n  mutate(local_moran = local_moran(\n    DengueCases, Neighbors, Weights, nsim = 99),\n         .before = 1) %>%\n  unnest(local_moran)\n```\n:::\n\n\nVisualising local Moran’s I\n\nDefine a new color palette\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolorRamp <- brewer.pal(n = 5, name = \"YlGnBu\")\ncolorRamp <- rev(colorRamp)\n```\n:::\n\n\n\nPrepare a choropleth map using the ii field\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(lisa) +\n  tm_fill(\"ii\", palette = colorRamp) + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"Local Moran's I of Dengue Cases\",\n            main.title.size = 0.8)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\n\nVisualising p-value of local Moran’s I\n\nPrepare a choropleth map using the p_ii_sim field\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(lisa) +\n  tm_fill(\"p_ii_sim\", palette = colorRamp) + \n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"P-value of Local Moran's I\",\n            main.title.size = 0.8)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\n\nVisualising local Moran’s I and p-value\n\nPlot both maps next to each other for comparison\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\nlocalmoral_map <- tm_shape(lisa) +\n  tm_fill(\"ii\", palette = colorRamp) + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"Local Moran's I of Dengue Cases\",\n            main.title.size = 0.8)\n\npvalue_map <- tm_shape(lisa) +\n  tm_fill(\"p_ii\",\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"),\n          palette = colorRamp) + \n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"P-value of Local Moran's I\",\n            main.title.size = 0.8)\n\ntmap_arrange(localmoral_map, pvalue_map, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\n\n\nVisualising LISA map\n\nFilter significant values\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlisa_sig <- lisa  %>%\n  filter(p_ii < 0.05)\n```\n:::\n\n\nPlot LISA map\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(lisa) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(lisa_sig) +\n  tm_fill(\"mean\", palette = colorRamp) + \n  tm_borders(alpha = 0.4)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-46-1.png){width=672}\n:::\n:::\n\n\n\n# Hot Spot and Cold Spot Area Analysis (HCSA)\n\nCompute local Gi* statistic for spatial autocorrelation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsw_nb <- tainan_dengue %>%\n  mutate(Neighbors = include_self(st_contiguity(geometry)),\n         Weights = st_inverse_distance(Neighbors, geometry,\n                                        scale = 1,\n                                        alpha = 1),\n         .before = 1)\n```\n:::\n\n\nCalculate the Local Gi* statistic for each observation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHot_Cold_Spot_Analysis <- sw_nb %>% \n  mutate(Local_Gi = local_gstar_perm(\n    DengueCases, Neighbors, Weights, nsim = 99),\n         .before = 1) %>%\n  unnest(Local_Gi)\n```\n:::\n\n\n## Visualising Gi*\n\nDefine a new color palette\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolorRamp <- brewer.pal(n = 5, name = \"YlGn\")\ncolorRamp <- rev(colorRamp)\n```\n:::\n\n\nPrepare a choropleth map using the gi_star field\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(Hot_Cold_Spot_Analysis) +\n  tm_fill(\"gi_star\", palette = colorRamp) + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-50-1.png){width=672}\n:::\n:::\n\n\n## Visualising p-value of Hot_Cold_Spot_Analysis\n\nPrepare a choropleth map using the p_sim field\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(Hot_Cold_Spot_Analysis) +\n  tm_fill(\"p_sim\", palette = colorRamp) + \n  tm_borders(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-51-1.png){width=672}\n:::\n:::\n\n\n## Visualising local Hot_Cold_Spot_Analysis & hot spot and cold spot areas\n\n### Visualising local Hot_Cold_Spot_Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot both maps next to each other for comparison\ntmap_mode(\"plot\")\n```\n:::\n\n\nCreate a map for Local Gi* of Dengue Cases\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlocalGi_map <- tm_shape(Hot_Cold_Spot_Analysis) +\n  tm_fill(\"gi_star\", palette = colorRamp) + \n  tm_borders(alpha = 0.5) +\n  tm_view(set.zoom.limits = c(6,8)) +\n  tm_layout(main.title = \"Local Gi* of Dengue Cases\",\n            main.title.size = 0.8)\n```\n:::\n\n\nCreate a map for P-value of Local Gi*\n\n\n::: {.cell}\n\n```{.r .cell-code}\npValue_map <- tm_shape(Hot_Cold_Spot_Analysis) +\n  tm_fill(\"p_sim\",\n          breaks = c(0, 0.001, 0.01, 0.05, 1),\n          labels = c(\"0.001\", \"0.01\", \"0.05\", \"Not sig\"),\n          palette = colorRamp) + \n  tm_borders(alpha = 0.5) +\n  tm_layout(main.title = \"P-value of Local Gi*\",\n            main.title.size = 0.8)\n```\n:::\n\n\nArrange the two maps side by side\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_arrange(localGi_map, pValue_map, ncol = 2)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-55-1.png){width=672}\n:::\n:::\n\n\n\n### Visualising hot spot and cold spot areas\n\nDefine a new color palette\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolorRamp <- brewer.pal(n = 5, name = \"BuPu\")\ncolorRamp <- rev(colorRamp)\n```\n:::\n\n\nFilter significant values (i.e., p-values less than 0.05)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSignificant_HCSA <- Hot_Cold_Spot_Analysis  %>%\n  filter(p_sim < 0.05)\n```\n:::\n\n\nPlot the significant hot spot and cold spot areas\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(Hot_Cold_Spot_Analysis) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(Significant_HCSA) +\n  tm_fill(\"gi_star\", palette = colorRamp) + \n  tm_borders(alpha = 0.4)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-58-1.png){width=672}\n:::\n:::\n\n\n# Performing Emerging Hotspot Analysis\n\n## Creating a Time series cube\n\nFilering to the columns for time series\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\nSelecting only necessary data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntainan_dengue_ehsa <- tainan_dengue_ehsa %>%\n  select(1,11,12)\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nConvert the data frame to tibble\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue_drop_ehsa <- as_tibble(dengue_drop_ehsa)\ndengue_spacetime <- spacetime(dengue_drop_ehsa, tainan,\n                      .loc_col = \"VILLCODE\",\n                      .time_col = \"epi_week_number\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nis_spacetime_cube(dengue_spacetime)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndengue_neighbor_weights <- dengue_spacetime %>%\n  activate(\"geometry\") %>%\n  mutate(nb = include_self(st_contiguity(geometry)),\n         wt = st_inverse_distance(nb, geometry,\n                                  scale = 1,\n                                  alpha = 1),\n         .before = 1) %>%\n  set_nbs(\"nb\") %>%\n  set_wts(\"wt\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngi_stars <- dengue_neighbor_weights %>% \n  group_by(epi_week_number) %>% \n  mutate(gi_star = local_gstar_perm(\n    count, nb, wt)) %>% \n  tidyr::unnest(gi_star)\n```\n:::\n\n\n## Mann-Kendall Test\n\nFirst, define a function that takes a VILLCODE as an argument and generates the plot for that VILLCODE:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenerate_plot <- function(villcode) {\n  cbg <- gi_stars %>% \n    ungroup() %>% \n    filter(VILLCODE == villcode) |> \n    select(VILLCODE, epi_week_number, gi_star)\n\n  p <- ggplot(data = cbg, \n         aes(x = epi_week_number, \n             y = gi_star)) +\n    geom_line() +\n    theme_light()\n\n  ggplotly(p)\n}\n```\n:::\n\n\ncall this function with the VILLCODE:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenerate_plot(67000370005)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-e2ecedf8c1e4e9e0fe9e\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-e2ecedf8c1e4e9e0fe9e\">{\"x\":{\"data\":[{\"x\":[31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],\"y\":[-0.50216442578360321,-1.1806520050840903,-1.4501806591125181,-1.039450247717095,-1.459685849564619,-1.7891355919676957,-1.6587338446563735,-1.1815179994243794,-0.53480366118858602,0.12286891765831108,-1.1540762498790433,-0.25961100586697067,-1.4106321320042634,-0.0089123945718893125,0.94350410639371096,1.7101141060360523,0.041212060174089064,1.9097854059674699,3.698348879083019,0.38392036446479527],\"text\":[\"epi_week_number: 31<br />gi_star: -0.502164426\",\"epi_week_number: 32<br />gi_star: -1.180652005\",\"epi_week_number: 33<br />gi_star: -1.450180659\",\"epi_week_number: 34<br />gi_star: -1.039450248\",\"epi_week_number: 35<br />gi_star: -1.459685850\",\"epi_week_number: 36<br />gi_star: -1.789135592\",\"epi_week_number: 37<br />gi_star: -1.658733845\",\"epi_week_number: 38<br />gi_star: -1.181517999\",\"epi_week_number: 39<br />gi_star: -0.534803661\",\"epi_week_number: 40<br />gi_star:  0.122868918\",\"epi_week_number: 41<br />gi_star: -1.154076250\",\"epi_week_number: 42<br />gi_star: -0.259611006\",\"epi_week_number: 43<br />gi_star: -1.410632132\",\"epi_week_number: 44<br />gi_star: -0.008912395\",\"epi_week_number: 45<br />gi_star:  0.943504106\",\"epi_week_number: 46<br />gi_star:  1.710114106\",\"epi_week_number: 47<br />gi_star:  0.041212060\",\"epi_week_number: 48<br />gi_star:  1.909785406\",\"epi_week_number: 49<br />gi_star:  3.698348879\",\"epi_week_number: 50<br />gi_star:  0.383920364\"],\"type\":\"scatter\",\"mode\":\"lines\",\"line\":{\"width\":1.8897637795275593,\"color\":\"rgba(0,0,0,1)\",\"dash\":\"solid\"},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":26.228310502283104,\"r\":7.3059360730593621,\"b\":40.182648401826491,\"l\":37.260273972602747},\"plot_bgcolor\":\"rgba(255,255,255,1)\",\"paper_bgcolor\":\"rgba(255,255,255,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[30.050000000000001,50.950000000000003],\"tickmode\":\"array\",\"ticktext\":[\"35\",\"40\",\"45\",\"50\"],\"tickvals\":[35,40,45,50],\"categoryorder\":\"array\",\"categoryarray\":[\"35\",\"40\",\"45\",\"50\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(179,179,179,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.33208800332088001,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(222,222,222,1)\",\"gridwidth\":0.33208800332088001,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"epi_week_number\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-2.0635098155202316,3.9727231026355549],\"tickmode\":\"array\",\"ticktext\":[\"-2\",\"-1\",\"0\",\"1\",\"2\",\"3\"],\"tickvals\":[-2,-1,0,1,2,3],\"categoryorder\":\"array\",\"categoryarray\":[\"-2\",\"-1\",\"0\",\"1\",\"2\",\"3\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(179,179,179,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.33208800332088001,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(222,222,222,1)\",\"gridwidth\":0.33208800332088001,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"gi_star\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":\"transparent\",\"line\":{\"color\":\"rgba(179,179,179,1)\",\"width\":0.66417600664176002,\"linetype\":\"solid\"},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.8897637795275593,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.68949771689498}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"6cf810543f26\":{\"x\":{},\"y\":{},\"type\":\"scatter\"}},\"cur_data\":\"6cf810543f26\",\"visdat\":{\"6cf810543f26\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n\n```{.r .cell-code}\ngenerate_plot(67000310033)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-56ded1fcbf305623a1ac\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-56ded1fcbf305623a1ac\">{\"x\":{\"data\":[{\"x\":[31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],\"y\":[4.0735657187212437,4.8081535985934893,3.5182124914872484,2.0347299275029114,1.2016717275414099,2.4099261235988667,1.4766438827843638,0.89918621879195593,1.4718177686271021,-0.024870301785805491,0.83628932436229142,1.1081850852319091,1.5157973892381911,0.33846405999291534,1.2149507506638373,0.1829791975069377,1.2438484526697893,0.54067360975712142,2.2960515509835617,0.26430740924293161],\"text\":[\"epi_week_number: 31<br />gi_star:  4.0735657\",\"epi_week_number: 32<br />gi_star:  4.8081536\",\"epi_week_number: 33<br />gi_star:  3.5182125\",\"epi_week_number: 34<br />gi_star:  2.0347299\",\"epi_week_number: 35<br />gi_star:  1.2016717\",\"epi_week_number: 36<br />gi_star:  2.4099261\",\"epi_week_number: 37<br />gi_star:  1.4766439\",\"epi_week_number: 38<br />gi_star:  0.8991862\",\"epi_week_number: 39<br />gi_star:  1.4718178\",\"epi_week_number: 40<br />gi_star: -0.0248703\",\"epi_week_number: 41<br />gi_star:  0.8362893\",\"epi_week_number: 42<br />gi_star:  1.1081851\",\"epi_week_number: 43<br />gi_star:  1.5157974\",\"epi_week_number: 44<br />gi_star:  0.3384641\",\"epi_week_number: 45<br />gi_star:  1.2149508\",\"epi_week_number: 46<br />gi_star:  0.1829792\",\"epi_week_number: 47<br />gi_star:  1.2438485\",\"epi_week_number: 48<br />gi_star:  0.5406736\",\"epi_week_number: 49<br />gi_star:  2.2960516\",\"epi_week_number: 50<br />gi_star:  0.2643074\"],\"type\":\"scatter\",\"mode\":\"lines\",\"line\":{\"width\":1.8897637795275593,\"color\":\"rgba(0,0,0,1)\",\"dash\":\"solid\"},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":26.228310502283104,\"r\":7.3059360730593621,\"b\":40.182648401826491,\"l\":31.415525114155255},\"plot_bgcolor\":\"rgba(255,255,255,1)\",\"paper_bgcolor\":\"rgba(255,255,255,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[30.050000000000001,50.950000000000003],\"tickmode\":\"array\",\"ticktext\":[\"35\",\"40\",\"45\",\"50\"],\"tickvals\":[35,40,45,50],\"categoryorder\":\"array\",\"categoryarray\":[\"35\",\"40\",\"45\",\"50\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(179,179,179,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.33208800332088001,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(222,222,222,1)\",\"gridwidth\":0.33208800332088001,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"epi_week_number\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-0.26652149680477022,5.0498047936124539],\"tickmode\":\"array\",\"ticktext\":[\"0\",\"1\",\"2\",\"3\",\"4\",\"5\"],\"tickvals\":[0,1,2,3,4,5],\"categoryorder\":\"array\",\"categoryarray\":[\"0\",\"1\",\"2\",\"3\",\"4\",\"5\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(179,179,179,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.33208800332088001,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(222,222,222,1)\",\"gridwidth\":0.33208800332088001,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"gi_star\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":\"transparent\",\"line\":{\"color\":\"rgba(179,179,179,1)\",\"width\":0.66417600664176002,\"linetype\":\"solid\"},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.8897637795275593,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.68949771689498}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"6cf83dc6257\":{\"x\":{},\"y\":{},\"type\":\"scatter\"}},\"cur_data\":\"6cf83dc6257\",\"visdat\":{\"6cf83dc6257\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n\n```{.r .cell-code}\ngenerate_plot(67000350032)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-0610e247e5c0adfbea84\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-0610e247e5c0adfbea84\">{\"x\":{\"data\":[{\"x\":[31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],\"y\":[-0.76953858609621484,-1.0570155643917327,-1.0152492812208826,-1.1706937055030777,-1.4388702737432149,-1.5607552937558211,-1.594744260521413,-1.9090788518987165,-1.8095666589673136,-2.0956475476872658,-1.8771709936084202,-1.9852658586688157,-1.8843186240800549,-2.1526037004719116,-1.8380042642593513,-1.4809600441091031,-0.98621151043427602,-1.1426536232206619,-1.0281852645185667,0.26877677041112735],\"text\":[\"epi_week_number: 31<br />gi_star: -0.7695386\",\"epi_week_number: 32<br />gi_star: -1.0570156\",\"epi_week_number: 33<br />gi_star: -1.0152493\",\"epi_week_number: 34<br />gi_star: -1.1706937\",\"epi_week_number: 35<br />gi_star: -1.4388703\",\"epi_week_number: 36<br />gi_star: -1.5607553\",\"epi_week_number: 37<br />gi_star: -1.5947443\",\"epi_week_number: 38<br />gi_star: -1.9090789\",\"epi_week_number: 39<br />gi_star: -1.8095667\",\"epi_week_number: 40<br />gi_star: -2.0956475\",\"epi_week_number: 41<br />gi_star: -1.8771710\",\"epi_week_number: 42<br />gi_star: -1.9852659\",\"epi_week_number: 43<br />gi_star: -1.8843186\",\"epi_week_number: 44<br />gi_star: -2.1526037\",\"epi_week_number: 45<br />gi_star: -1.8380043\",\"epi_week_number: 46<br />gi_star: -1.4809600\",\"epi_week_number: 47<br />gi_star: -0.9862115\",\"epi_week_number: 48<br />gi_star: -1.1426536\",\"epi_week_number: 49<br />gi_star: -1.0281853\",\"epi_week_number: 50<br />gi_star:  0.2687768\"],\"type\":\"scatter\",\"mode\":\"lines\",\"line\":{\"width\":1.8897637795275593,\"color\":\"rgba(0,0,0,1)\",\"dash\":\"solid\"},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":26.228310502283104,\"r\":7.3059360730593621,\"b\":40.182648401826491,\"l\":48.949771689497723},\"plot_bgcolor\":\"rgba(255,255,255,1)\",\"paper_bgcolor\":\"rgba(255,255,255,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[30.050000000000001,50.950000000000003],\"tickmode\":\"array\",\"ticktext\":[\"35\",\"40\",\"45\",\"50\"],\"tickvals\":[35,40,45,50],\"categoryorder\":\"array\",\"categoryarray\":[\"35\",\"40\",\"45\",\"50\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(179,179,179,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.33208800332088001,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(222,222,222,1)\",\"gridwidth\":0.33208800332088001,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"epi_week_number\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-2.2736727240160635,0.3898457939552793],\"tickmode\":\"array\",\"ticktext\":[\"-2.0\",\"-1.5\",\"-1.0\",\"-0.5\",\"0.0\"],\"tickvals\":[-2,-1.5,-1,-0.50000000000000022,0],\"categoryorder\":\"array\",\"categoryarray\":[\"-2.0\",\"-1.5\",\"-1.0\",\"-0.5\",\"0.0\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(179,179,179,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.33208800332088001,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(222,222,222,1)\",\"gridwidth\":0.33208800332088001,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"gi_star\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":\"transparent\",\"line\":{\"color\":\"rgba(179,179,179,1)\",\"width\":0.66417600664176002,\"linetype\":\"solid\"},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.8897637795275593,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.68949771689498}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"6cf815365754\":{\"x\":{},\"y\":{},\"type\":\"scatter\"}},\"cur_data\":\"6cf815365754\",\"visdat\":{\"6cf815365754\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n\n```{.r .cell-code}\ngenerate_plot(67000350017)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item\" id=\"htmlwidget-ee62540afc6183ec2409\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ee62540afc6183ec2409\">{\"x\":{\"data\":[{\"x\":[31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],\"y\":[-0.75297789398975801,-0.051456950178079504,0.52693964556770034,1.8515152753372499,0.62012639911968093,0.61466011772288298,0.62410512659365491,-0.64441642217206085,0.27898658786379743,-0.11109145872814276,-0.62420379306850948,-1.5710984134295389,-0.9351554591699649,-0.13274416335009395,-0.33839670991930393,-1.3624553869289009,-0.97353678776977637,-0.7130468757261369,-0.56292897584778323,-1.1798715992829802],\"text\":[\"epi_week_number: 31<br />gi_star: -0.75297789\",\"epi_week_number: 32<br />gi_star: -0.05145695\",\"epi_week_number: 33<br />gi_star:  0.52693965\",\"epi_week_number: 34<br />gi_star:  1.85151528\",\"epi_week_number: 35<br />gi_star:  0.62012640\",\"epi_week_number: 36<br />gi_star:  0.61466012\",\"epi_week_number: 37<br />gi_star:  0.62410513\",\"epi_week_number: 38<br />gi_star: -0.64441642\",\"epi_week_number: 39<br />gi_star:  0.27898659\",\"epi_week_number: 40<br />gi_star: -0.11109146\",\"epi_week_number: 41<br />gi_star: -0.62420379\",\"epi_week_number: 42<br />gi_star: -1.57109841\",\"epi_week_number: 43<br />gi_star: -0.93515546\",\"epi_week_number: 44<br />gi_star: -0.13274416\",\"epi_week_number: 45<br />gi_star: -0.33839671\",\"epi_week_number: 46<br />gi_star: -1.36245539\",\"epi_week_number: 47<br />gi_star: -0.97353679\",\"epi_week_number: 48<br />gi_star: -0.71304688\",\"epi_week_number: 49<br />gi_star: -0.56292898\",\"epi_week_number: 50<br />gi_star: -1.17987160\"],\"type\":\"scatter\",\"mode\":\"lines\",\"line\":{\"width\":1.8897637795275593,\"color\":\"rgba(0,0,0,1)\",\"dash\":\"solid\"},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":26.228310502283104,\"r\":7.3059360730593621,\"b\":40.182648401826491,\"l\":37.260273972602747},\"plot_bgcolor\":\"rgba(255,255,255,1)\",\"paper_bgcolor\":\"rgba(255,255,255,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[30.050000000000001,50.950000000000003],\"tickmode\":\"array\",\"ticktext\":[\"35\",\"40\",\"45\",\"50\"],\"tickvals\":[35,40,45,50],\"categoryorder\":\"array\",\"categoryarray\":[\"35\",\"40\",\"45\",\"50\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(179,179,179,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.33208800332088001,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(222,222,222,1)\",\"gridwidth\":0.33208800332088001,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"epi_week_number\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[-1.7422290978678783,2.0226459597755895],\"tickmode\":\"array\",\"ticktext\":[\"-1\",\"0\",\"1\",\"2\"],\"tickvals\":[-1,0,1,2],\"categoryorder\":\"array\",\"categoryarray\":[\"-1\",\"0\",\"1\",\"2\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(179,179,179,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.33208800332088001,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(222,222,222,1)\",\"gridwidth\":0.33208800332088001,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"gi_star\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":\"transparent\",\"line\":{\"color\":\"rgba(179,179,179,1)\",\"width\":0.66417600664176002,\"linetype\":\"solid\"},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.8897637795275593,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.68949771689498}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"6cf86d0d6e68\":{\"x\":{},\"y\":{},\"type\":\"scatter\"}},\"cur_data\":\"6cf86d0d6e68\",\"visdat\":{\"6cf86d0d6e68\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmann_kendall_test <- function(data) {\n  data %>%\n    group_by(VILLCODE) %>%\n    summarise(mk = list(\n      unclass(\n        Kendall::MannKendall(gi_star)))) %>%\n    tidyr::unnest_wider(mk)\n}\n\n# Use the function\nehsa_mk <- mann_kendall_test(gi_stars)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\narrange_spots <- function(data) {\n  data %>% \n    arrange(sl, abs(tau)) %>% \n    slice(1:5)\n}\n\n# Use the function\nemerging <- arrange_spots(ehsa_mk)\n```\n:::\n\n\n\nPerform ESHA Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemerging_hotspot_analysis <- emerging_hotspot_analysis(\n  x = dengue_spacetime, \n  .var = \"count\", \n  k = 1, \n  nsim = 99\n)\n```\n:::\n\n\n## Visualize the distribution of EHSA classes:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = emerging_hotspot_analysis,\n       aes(x = classification, fill = classification)) +\n  geom_bar() +\n  scale_fill_brewer(palette = \"Set3\") +\n  theme_minimal() +\n  labs(x = \"EHSA Classification\", y = \"Count\", title = \"Distribution of EHSA Classes\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-72-1.png){width=672}\n:::\n:::\n\n\nJoin the datas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nemerging_hotspot_analysis_Tainan <- tainan %>%\n  left_join(emerging_hotspot_analysis,\n            by = join_by(VILLCODE == location))\n```\n:::\n\n\nFilter the significant hotspots and store them in a variable \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsignificant_hotspots <- emerging_hotspot_analysis_Tainan  %>%\n  filter(p_value < 0.05)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\ntm_shape(emerging_hotspot_analysis_Tainan) +\n  tm_polygons() +\n  tm_borders(alpha = 0.5) +\ntm_shape(significant_hotspots) +\n  tm_fill(\"classification\", palette = brewer.pal(n = 8, name = \"Paired\")) +\n  tm_borders(alpha = 0.4)\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex02_files/figure-html/unnamed-chunk-75-1.png){width=672}\n:::\n:::\n\n\n\n# Reflection\n\nReflecting on this task, I can't help but appreciate the journey it took me on. Initially, it felt daunting and exhausting, but as I persevered, I discovered immense personal and professional growth along the way. Every problem I encountered became an opportunity to learn, and each obstacle I faced was a chance to overcome and thrive. Despite the moments of frustration and doubt, I now see them as essential parts of the learning process. Looking back, I'm filled with gratitude for the valuable lessons learned and the skills acquired. The experience of exploring different libraries and delving into new knowledge was not only enjoyable but also incredibly fulfilling. As I conclude this reflection, I am thankful for the opportunity to have tackled this challenge and emerged stronger and more knowledgeable than before.\n\n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "Take-home_Ex02_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\r\n<script src=\"../../site_libs/plotly-binding-4.10.4/plotly.js\"></script>\r\n<script src=\"../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\r\n<script src=\"../../site_libs/jquery-3.5.1/jquery.min.js\"></script>\r\n<link href=\"../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\r\n<link href=\"../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}