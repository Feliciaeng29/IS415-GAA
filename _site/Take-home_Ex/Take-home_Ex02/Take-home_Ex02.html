<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Felicia Eng">
<meta name="dcterms.date" content="2024-02-01">

<title>IS415-GAA - Take-home Exercise 2: Application of Spatial and Spatio-temporal Analysis Methods to Discover the Distribution of Dengue Fever in Tainan City, Taiwan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="../../site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="../../site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="../../site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="../../site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03_1.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 3-1st Order</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03_2.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 3-2nd Order</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03_part2/Hands-on_Ex03_3.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 3: Network Constrained</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html" rel="" target="">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex02/In-class_Ex02.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-class_Ex03_1.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 3-KDE</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03_NKDE/In-class_Ex03_NKDE.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 3-NKDE</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex04/In-class_Ex04.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex05.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex06/In-class_Ex06-EHSA.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 6-EHSA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex06/In-class_Ex06-GLSA.html" rel="" target="">
 <span class="dropdown-text">In-class Exercise 6-GLSA</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Take-home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html" rel="" target="">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-task" id="toc-the-task" class="nav-link active" data-scroll-target="#the-task"><strong>The Task</strong></a></li>
  <li><a href="#importing-packages" id="toc-importing-packages" class="nav-link" data-scroll-target="#importing-packages"><strong>Importing Packages</strong></a></li>
  <li><a href="#importing-datasets-to-r-environment" id="toc-importing-datasets-to-r-environment" class="nav-link" data-scroll-target="#importing-datasets-to-r-environment">*Importing Datasets to R Environment**</a>
  <ul class="collapse">
  <li><a href="#tainan-dataset" id="toc-tainan-dataset" class="nav-link" data-scroll-target="#tainan-dataset"><em>Tainan Dataset</em></a></li>
  <li><a href="#dengue-dataset" id="toc-dengue-dataset" class="nav-link" data-scroll-target="#dengue-dataset"><em>Dengue Dataset</em></a></li>
  </ul></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing">Data Preprocessing</a>
  <ul class="collapse">
  <li><a href="#dengue-dataset-1" id="toc-dengue-dataset-1" class="nav-link" data-scroll-target="#dengue-dataset-1">Dengue Dataset</a></li>
  <li><a href="#tainan-dataset-1" id="toc-tainan-dataset-1" class="nav-link" data-scroll-target="#tainan-dataset-1">Tainan Dataset</a></li>
  <li><a href="#visualizing-2-datasets-together" id="toc-visualizing-2-datasets-together" class="nav-link" data-scroll-target="#visualizing-2-datasets-together">Visualizing 2 datasets together</a></li>
  </ul></li>
  <li><a href="#visualizing-choropleth-map" id="toc-visualizing-choropleth-map" class="nav-link" data-scroll-target="#visualizing-choropleth-map">Visualizing Choropleth Map</a></li>
  <li><a href="#global-spatial-autocorrelation" id="toc-global-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-spatial-autocorrelation">Global Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#computing-global-morans-i" id="toc-computing-global-morans-i" class="nav-link" data-scroll-target="#computing-global-morans-i">Computing Global Moran’s I</a></li>
  <li><a href="#performing-global-morans-i-test" id="toc-performing-global-morans-i-test" class="nav-link" data-scroll-target="#performing-global-morans-i-test">Performing Global Moran’s I test</a></li>
  </ul></li>
  <li><a href="#local-spatial-autocorrelation-analysis" id="toc-local-spatial-autocorrelation-analysis" class="nav-link" data-scroll-target="#local-spatial-autocorrelation-analysis">Local Spatial Autocorrelation Analysis</a></li>
  <li><a href="#hot-spot-and-cold-spot-area-analysis-hcsa" id="toc-hot-spot-and-cold-spot-area-analysis-hcsa" class="nav-link" data-scroll-target="#hot-spot-and-cold-spot-area-analysis-hcsa">Hot Spot and Cold Spot Area Analysis (HCSA)</a>
  <ul class="collapse">
  <li><a href="#visualising-gi" id="toc-visualising-gi" class="nav-link" data-scroll-target="#visualising-gi">Visualising Gi*</a></li>
  <li><a href="#visualising-p-value-of-hot_cold_spot_analysis" id="toc-visualising-p-value-of-hot_cold_spot_analysis" class="nav-link" data-scroll-target="#visualising-p-value-of-hot_cold_spot_analysis">Visualising p-value of Hot_Cold_Spot_Analysis</a></li>
  <li><a href="#visualising-local-hot_cold_spot_analysis-hot-spot-and-cold-spot-areas" id="toc-visualising-local-hot_cold_spot_analysis-hot-spot-and-cold-spot-areas" class="nav-link" data-scroll-target="#visualising-local-hot_cold_spot_analysis-hot-spot-and-cold-spot-areas">Visualising local Hot_Cold_Spot_Analysis &amp; hot spot and cold spot areas</a>
  <ul class="collapse">
  <li><a href="#visualising-local-hot_cold_spot_analysis" id="toc-visualising-local-hot_cold_spot_analysis" class="nav-link" data-scroll-target="#visualising-local-hot_cold_spot_analysis">Visualising local Hot_Cold_Spot_Analysis</a></li>
  <li><a href="#visualising-hot-spot-and-cold-spot-areas" id="toc-visualising-hot-spot-and-cold-spot-areas" class="nav-link" data-scroll-target="#visualising-hot-spot-and-cold-spot-areas">Visualising hot spot and cold spot areas</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#performing-emerging-hotspot-analysis" id="toc-performing-emerging-hotspot-analysis" class="nav-link" data-scroll-target="#performing-emerging-hotspot-analysis">Performing Emerging Hotspot Analysis</a>
  <ul class="collapse">
  <li><a href="#creating-a-time-series-cube" id="toc-creating-a-time-series-cube" class="nav-link" data-scroll-target="#creating-a-time-series-cube">Creating a Time series cube</a></li>
  <li><a href="#mann-kendall-test" id="toc-mann-kendall-test" class="nav-link" data-scroll-target="#mann-kendall-test">Mann-Kendall Test</a></li>
  <li><a href="#visualize-the-distribution-of-ehsa-classes" id="toc-visualize-the-distribution-of-ehsa-classes" class="nav-link" data-scroll-target="#visualize-the-distribution-of-ehsa-classes">Visualize the distribution of EHSA classes:</a></li>
  </ul></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection">Reflection</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 2: Application of Spatial and Spatio-temporal Analysis Methods to Discover the Distribution of Dengue Fever in Tainan City, Taiwan</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Felicia Eng </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 1, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">February 29, 2024</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="the-task" class="level2">
<h2 class="anchored" data-anchor-id="the-task"><strong>The Task</strong></h2>
<p>The specific tasks of this take-home exercise are as follows:</p>
<ul>
<li><p>Using appropriate function of <strong>sf</strong> and <strong>tidyverse</strong>, preparing the following geospatial data layer:</p>
<ul>
<li><p>a study area layer in sf polygon features. It must be at village level and confined to the D01, D02, D04, D06, D07, D08, D32 and D39 counties of Tainan City, Taiwan.</p></li>
<li><p>a dengue fever layer within the study area in sf point features. The dengue fever cases should be confined to epidemiology week 31-50, 2023.</p></li>
<li><p>a derived dengue fever layer in <a href="https://sfdep.josiahparry.com/articles/spacetime-s3">spacetime s3 class of sfdep</a>. It should contain, among many other useful information, a data field showing number of dengue fever cases by village and by epidemiology week.</p></li>
</ul></li>
<li><p>Using the extracted data, perform global spatial autocorrelation analysis by using <a href="https://is415-gaa-tskam.netlify.app/in-class_ex/in-class_ex05/in-class_ex05-glsa">sfdep methods</a>.</p></li>
<li><p>Using the extracted data, perform local spatial autocorrelation analysis by using <a href="https://r4gdsa.netlify.app/chap10.html">sfdep methods</a>.</p></li>
<li><p>Using the extracted data, perform emerging hotspot analysis by using <a href="https://is415-gaa-tskam.netlify.app/in-class_ex/in-class_ex05/in-class_ex05-ehsa">sfdep methods</a>.</p></li>
<li><p>Describe the spatial patterns revealed by the analysis above.</p></li>
</ul>
</section>
<section id="importing-packages" class="level1">
<h1><strong>Importing Packages</strong></h1>
</section>
<section id="importing-datasets-to-r-environment" class="level1">
<h1>*Importing Datasets to R Environment**</h1>
<section id="tainan-dataset" class="level2">
<h2 class="anchored" data-anchor-id="tainan-dataset"><em>Tainan Dataset</em></h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `TAINAN_VILLAGE' from data source 
  `C:\Feliciaeng29\IS415-GAA\Take-home_Ex\Take-home_Ex02\data\geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 649 features and 10 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 120.0269 ymin: 22.88751 xmax: 120.6563 ymax: 23.41374
Geodetic CRS:  TWD97</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5 features and 10 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 120.053 ymin: 22.93251 xmax: 120.2905 ymax: 23.14345
Geodetic CRS:  TWD97
     VILLCODE COUNTYNAME TOWNNAME VILLNAME       VILLENG COUNTYID COUNTYCODE
1 67000280002     臺南市   歸仁區   六甲里   Liujia Vil.        D      67000
2 67000350032     臺南市   安南區   青草里  Qingcao Vil.        D      67000
3 67000150009     臺南市   七股區   溪南里    Xinan Vil.        D      67000
4 67000150010     臺南市   七股區   七股里     Qigu Vil.        D      67000
5 67000150008     臺南市   七股區   龍山里 Longshan Vil.        D      67000
  TOWNID TOWNCODE NOTE                       geometry
1    D33 67000280 &lt;NA&gt; POLYGON ((120.2725 22.95868...
2    D06 67000350 &lt;NA&gt; POLYGON ((120.1176 23.08387...
3    D22 67000150 &lt;NA&gt; POLYGON ((120.121 23.1355, ...
4    D22 67000150 &lt;NA&gt; POLYGON ((120.1312 23.1371,...
5    D22 67000150 &lt;NA&gt; POLYGON ((120.0845 23.13503...</code></pre>
</div>
</div>
<p>Let’s visualise the dataset that was just imported</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this case, st_transform(tainan, CRS=3414) is not needed</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: TWD97 
  wkt:
GEOGCRS["TWD97",
    DATUM["Taiwan Datum 1997",
        ELLIPSOID["GRS 1980",6378137,298.257222101,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["Taiwan, Republic of China - onshore and offshore - Taiwan Island, Penghu (Pescadores) Islands."],
        BBOX[17.36,114.32,26.96,123.61]],
    ID["EPSG",3824]]</code></pre>
</div>
</div>
</section>
<section id="dengue-dataset" class="level2">
<h2 class="anchored" data-anchor-id="dengue-dataset"><em>Dengue Dataset</em></h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 106,861 × 26
   發病日     個案研判日 通報日     性別  年齡層 居住縣市 居住鄉鎮 居住村里
   &lt;date&gt;     &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
 1 1998-01-02 None       1998-01-07 男    40-44  屏東縣   屏東市   None    
 2 1998-01-03 None       1998-01-14 男    30-34  屏東縣   東港鎮   None    
 3 1998-01-13 None       1998-02-18 男    55-59  宜蘭縣   宜蘭市   None    
 4 1998-01-15 None       1998-01-23 男    35-39  高雄市   苓雅區   None    
 5 1998-01-20 None       1998-02-04 男    55-59  宜蘭縣   五結鄉   None    
 6 1998-01-22 None       1998-02-19 男    20-24  桃園市   蘆竹區   None    
 7 1998-01-23 None       1998-02-02 男    40-44  新北市   新店區   None    
 8 1998-01-26 None       1998-02-19 女    65-69  台北市   北投區   None    
 9 1998-02-11 None       1998-02-13 女    25-29  台南市   南區     None    
10 1998-02-16 None       1998-02-24 男    20-24  高雄市   楠梓區   None    
# ℹ 106,851 more rows
# ℹ 18 more variables: 最小統計區 &lt;chr&gt;, 最小統計區中心點X &lt;chr&gt;,
#   最小統計區中心點Y &lt;chr&gt;, 一級統計區 &lt;chr&gt;, 二級統計區 &lt;chr&gt;,
#   感染縣市 &lt;chr&gt;, 感染鄉鎮 &lt;chr&gt;, 感染村里 &lt;chr&gt;, 是否境外移入 &lt;chr&gt;,
#   感染國家 &lt;chr&gt;, 確定病例數 &lt;dbl&gt;, 居住村里代碼 &lt;chr&gt;, 感染村里代碼 &lt;chr&gt;,
#   血清型 &lt;chr&gt;, 內政部居住縣市代碼 &lt;chr&gt;, 內政部居住鄉鎮代碼 &lt;chr&gt;,
#   內政部感染縣市代碼 &lt;chr&gt;, 內政部感染鄉鎮代碼 &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>     發病日            個案研判日            通報日          
 Min.   :1998-01-02   Length:106861      Min.   :1998-01-07  
 1st Qu.:2014-10-28   Class :character   1st Qu.:2014-10-31  
 Median :2015-09-29   Mode  :character   Median :2015-10-01  
 Mean   :2016-03-31                      Mean   :2016-04-03  
 3rd Qu.:2023-06-19                      3rd Qu.:2023-06-23  
 Max.   :2024-01-29                      Max.   :2024-01-29  
     性別              年齡層            居住縣市           居住鄉鎮        
 Length:106861      Length:106861      Length:106861      Length:106861     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
   居住村里          最小統計區        最小統計區中心點X  最小統計區中心點Y 
 Length:106861      Length:106861      Length:106861      Length:106861     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
  一級統計區         二級統計區          感染縣市           感染鄉鎮        
 Length:106861      Length:106861      Length:106861      Length:106861     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
   感染村里         是否境外移入         感染國家           確定病例數
 Length:106861      Length:106861      Length:106861      Min.   :1   
 Class :character   Class :character   Class :character   1st Qu.:1   
 Mode  :character   Mode  :character   Mode  :character   Median :1   
                                                          Mean   :1   
                                                          3rd Qu.:1   
                                                          Max.   :2   
 居住村里代碼       感染村里代碼          血清型          內政部居住縣市代碼
 Length:106861      Length:106861      Length:106861      Length:106861     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
 內政部居住鄉鎮代碼 內政部感染縣市代碼 內政部感染鄉鎮代碼
 Length:106861      Length:106861      Length:106861     
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         </code></pre>
</div>
</div>
</section>
</section>
<section id="data-preprocessing" class="level1">
<h1>Data Preprocessing</h1>
<section id="dengue-dataset-1" class="level2">
<h2 class="anchored" data-anchor-id="dengue-dataset-1">Dengue Dataset</h2>
<p>As stated a dengue fever layer within the study area in sf point features. The dengue fever cases should be confined to epidemiology week 31-50, 2023.</p>
<p>Convert the date column to Date format</p>
<p>Extract epidemiology week numbers from the onset date column</p>
<p>Define the desired epidemiology week range</p>
<p>Define the year of interest</p>
<p>Filter rows based on the specified epidemiology week range and study year</p>
<p>Check the data</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>     發病日            個案研判日            通報日          
 Min.   :2023-07-31   Length:25480       Min.   :2023-07-31  
 1st Qu.:2023-09-11   Class :character   1st Qu.:2023-09-13  
 Median :2023-10-01   Mode  :character   Median :2023-10-03  
 Mean   :2023-10-03                      Mean   :2023-10-05  
 3rd Qu.:2023-10-26                      3rd Qu.:2023-10-27  
 Max.   :2023-12-17                      Max.   :2023-12-23  
     性別              年齡層            居住縣市           居住鄉鎮        
 Length:25480       Length:25480       Length:25480       Length:25480      
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
   居住村里          最小統計區        最小統計區中心點X  最小統計區中心點Y 
 Length:25480       Length:25480       Length:25480       Length:25480      
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
  一級統計區         二級統計區          感染縣市           感染鄉鎮        
 Length:25480       Length:25480       Length:25480       Length:25480      
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
   感染村里         是否境外移入         感染國家           確定病例數
 Length:25480       Length:25480       Length:25480       Min.   :1   
 Class :character   Class :character   Class :character   1st Qu.:1   
 Mode  :character   Mode  :character   Mode  :character   Median :1   
                                                          Mean   :1   
                                                          3rd Qu.:1   
                                                          Max.   :1   
 居住村里代碼       感染村里代碼          血清型          內政部居住縣市代碼
 Length:25480       Length:25480       Length:25480       Length:25480      
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
 內政部居住鄉鎮代碼 內政部感染縣市代碼 內政部感染鄉鎮代碼 epi_week_number
 Length:25480       Length:25480       Length:25480       Min.   :31.00  
 Class :character   Class :character   Class :character   1st Qu.:37.00  
 Mode  :character   Mode  :character   Mode  :character   Median :39.00  
                                                          Mean   :39.84  
                                                          3rd Qu.:43.00  
                                                          Max.   :50.00  </code></pre>
</div>
</div>
<p>Select and rename columns</p>
<p>Check the form of x and y coordinates</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>Changing it to numerical for x and y coords</p>
<p>As it can be seen: Warning: NAs introduced by coercionWarning: NAs introduced by coercion</p>
<p>Lets remove the NA values from all the columns</p>
<p>Double check the data before moving on</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<p>Convert to an sf object with POINT geometry</p>
<p>Remove missing values</p>
<p>Group by village and calculate the number of dengue cases</p>
</section>
<section id="tainan-dataset-1" class="level2">
<h2 class="anchored" data-anchor-id="tainan-dataset-1">Tainan Dataset</h2>
<p>As stated: a study area layer in sf polygon features. It must be at village level and confined to the D01, D02, D04, D06, D07, D08, D32 and D39 counties of Tainan City, Taiwan.</p>
<p>Retrieve D01, D02, D04, D06, D07, D08, D32 and D39 counties of Tainan City, Taiwan.</p>
<p>So lets use the TOWNID to filter out only the specified countries. In this case we can also use subset(select = -NOTE) to exclude it from the dataframe.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 10 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 120.0936 ymin: 22.9156 xmax: 120.2585 ymax: 23.08827
Geodetic CRS:  TWD97
      VILLCODE COUNTYNAME TOWNNAME VILLNAME       VILLENG COUNTYID COUNTYCODE
2  67000350032     臺南市   安南區   青草里  Qingcao Vil.        D      67000
18 67000270011     臺南市   仁德區   保安里   Bao'an Vil.        D      67000
66 67000370005     臺南市   中西區   赤嵌里  Chihkan Vil.        D      67000
67 67000330004     臺南市     南區   大成里  Dacheng Vil.        D      67000
68 67000350028     臺南市   安南區   城北里 Chengbei Vil.        D      67000
69 67000350030     臺南市   安南區   城南里 Chengnan Vil.        D      67000
   TOWNID TOWNCODE NOTE                       geometry
2     D06 67000350 &lt;NA&gt; POLYGON ((120.1176 23.08387...
18    D32 67000270 &lt;NA&gt; POLYGON ((120.2304 22.93544...
66    D08 67000370 &lt;NA&gt; POLYGON ((120.2012 22.99966...
67    D02 67000330 &lt;NA&gt; POLYGON ((120.1985 22.98147...
68    D06 67000350 &lt;NA&gt; POLYGON ((120.1292 23.06512...
69    D06 67000350 &lt;NA&gt; POLYGON ((120.1246 23.06904...</code></pre>
</div>
</div>
<p>Lets plot to visualise</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="visualizing-2-datasets-together" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-2-datasets-together">Visualizing 2 datasets together</h2>
<p>Visualizing the distribution of dengue cases on the tainan map</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Combining both data frame into one</p>
</section>
</section>
<section id="visualizing-choropleth-map" class="level1">
<h1>Visualizing Choropleth Map</h1>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-28-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-28-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="global-spatial-autocorrelation" class="level1">
<h1>Global Spatial Autocorrelation</h1>
<p>Contiguity weights: Queen’s method</p>
<p>We compute spatial contiguity relationships among geometries stored in a data frame, calculates spatial weights based on these relationships,and adds the resulting variables to the data frame.</p>
<p>Grouping data by village name and summarizing dengue cases</p>
<p>Removing rows with ‘None’ as village name</p>
<p>Joining the filtered Tainan data with the grouped dengue data</p>
<p>Replacing NA values in DengueCases with 0</p>
<p>Calculating spatial weights</p>
<p>Examining the contents of the spatial weights matrix</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 258
Columns: 14
$ Neighbors   &lt;nb&gt; &lt;6, 118, 160&gt;, &lt;126, 128, 138, 168, 222&gt;, &lt;68, 69, 172, 181…
$ Weights     &lt;list&gt; &lt;0.3333333, 0.3333333, 0.3333333&gt;, &lt;0.2, 0.2, 0.2, 0.2, 0…
$ VILLCODE    &lt;chr&gt; "67000350032", "67000270011", "67000370005", "67000330004"…
$ COUNTYNAME  &lt;chr&gt; "臺南市", "臺南市", "臺南市", "臺南市", "臺南市", "臺南市"…
$ TOWNNAME    &lt;chr&gt; "安南區", "仁德區", "中西區", "南區", "安南區", "安南區", …
$ VILLNAME    &lt;chr&gt; "青草里", "保安里", "赤嵌里", "大成里", "城北里", "城南里"…
$ VILLENG     &lt;chr&gt; "Qingcao Vil.", "Bao'an Vil.", "Chihkan Vil.", "Dacheng Vi…
$ COUNTYID    &lt;chr&gt; "D", "D", "D", "D", "D", "D", "D", "D", "D", "D", "D", "D"…
$ COUNTYCODE  &lt;chr&gt; "67000", "67000", "67000", "67000", "67000", "67000", "670…
$ TOWNID      &lt;chr&gt; "D06", "D32", "D08", "D02", "D06", "D06", "D08", "D06", "D…
$ TOWNCODE    &lt;chr&gt; "67000350", "67000270", "67000370", "67000330", "67000350"…
$ NOTE        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ DengueCases &lt;dbl&gt; 2, 33, 111, 29, 6, 13, 37, 48, 108, 66, 26, 2, 5, 11, 24, …
$ geometry    &lt;POLYGON [°]&gt; POLYGON ((120.1176 23.08387..., POLYGON ((120.2304…</code></pre>
</div>
</div>
<section id="computing-global-morans-i" class="level2">
<h2 class="anchored" data-anchor-id="computing-global-morans-i">Computing Global Moran’s I</h2>
<p>Calculate Global Moran’s I</p>
<p>Print the result</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ I: num 0.397
 $ K: num 4.83</code></pre>
</div>
</div>
</section>
<section id="performing-global-morans-i-test" class="level2">
<h2 class="anchored" data-anchor-id="performing-global-morans-i-test">Performing Global Moran’s I test</h2>
<p>Perform the Moran’s I test</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw    

Moran I statistic standard deviate = 10.902, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.396838835      -0.003891051       0.001351108 </code></pre>
</div>
</div>
<p>Performing Global Moran’s I permutation test</p>
<p>Set seed for reproducibility</p>
<p>Perform Monte Carlo simulation</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 100 

statistic = 0.39684, observed rank = 100, p-value &lt; 2.2e-16
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<p>The results of your Monte Carlo simulation are given as a list with two values: <strong><code>I</code></strong> and <strong><code>K</code></strong>.</p>
<ul>
<li><p><strong><code>I</code></strong> is the Moran’s I statistic, which measures spatial autocorrelation. A positive Moran’s I value (like 0.397 in your case) indicates positive spatial autocorrelation, which means that similar values tend to be located near each other. In the context of your analysis, this suggests that dengue cases are not randomly distributed across counties, but rather, counties with similar numbers of dengue cases tend to be located near each other.</p></li>
<li><p><strong><code>K</code></strong> is likely the test statistic for the permutation test, although without more context it’s hard to say for sure. In general, the permutation test is used to determine the significance of the Moran’s I statistic by comparing it to a distribution of Moran’s I values obtained by randomly permuting the spatial locations of the data.</p></li>
</ul>
<p>The above statistical analysis reveals a p-value less than the alpha threshold of 0.05. This provides substantial evidence to dismiss the null hypothesis, which suggests that the spatial distribution of dengue cases across counties is random and spatially independent. Given that the Moran’s I statistic exceeds 0, it’s reasonable to conclude that there’s a tendency for clustering in the spatial distribution of dengue cases.</p>
</section>
</section>
<section id="local-spatial-autocorrelation-analysis" class="level1">
<h1>Local Spatial Autocorrelation Analysis</h1>
<p>Computing local Moran’s I</p>
<p>Compute local Moran’s I statistic for spatial autocorrelation</p>
<p>Visualising local Moran’s I</p>
<p>Define a new color palette</p>
<p>Prepare a choropleth map using the ii field</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Visualising p-value of local Moran’s I</p>
<p>Prepare a choropleth map using the p_ii_sim field</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Visualising local Moran’s I and p-value</p>
<p>Plot both maps next to each other for comparison</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Visualising LISA map</p>
<p>Filter significant values</p>
<p>Plot LISA map</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="hot-spot-and-cold-spot-area-analysis-hcsa" class="level1">
<h1>Hot Spot and Cold Spot Area Analysis (HCSA)</h1>
<p>Compute local Gi* statistic for spatial autocorrelation</p>
<p>Calculate the Local Gi* statistic for each observation</p>
<section id="visualising-gi" class="level2">
<h2 class="anchored" data-anchor-id="visualising-gi">Visualising Gi*</h2>
<p>Define a new color palette</p>
<p>Prepare a choropleth map using the gi_star field</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="visualising-p-value-of-hot_cold_spot_analysis" class="level2">
<h2 class="anchored" data-anchor-id="visualising-p-value-of-hot_cold_spot_analysis">Visualising p-value of Hot_Cold_Spot_Analysis</h2>
<p>Prepare a choropleth map using the p_sim field</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="visualising-local-hot_cold_spot_analysis-hot-spot-and-cold-spot-areas" class="level2">
<h2 class="anchored" data-anchor-id="visualising-local-hot_cold_spot_analysis-hot-spot-and-cold-spot-areas">Visualising local Hot_Cold_Spot_Analysis &amp; hot spot and cold spot areas</h2>
<section id="visualising-local-hot_cold_spot_analysis" class="level3">
<h3 class="anchored" data-anchor-id="visualising-local-hot_cold_spot_analysis">Visualising local Hot_Cold_Spot_Analysis</h3>
<p>Create a map for Local Gi* of Dengue Cases</p>
<p>Create a map for P-value of Local Gi*</p>
<p>Arrange the two maps side by side</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="visualising-hot-spot-and-cold-spot-areas" class="level3">
<h3 class="anchored" data-anchor-id="visualising-hot-spot-and-cold-spot-areas">Visualising hot spot and cold spot areas</h3>
<p>Define a new color palette</p>
<p>Filter significant values (i.e., p-values less than 0.05)</p>
<p>Plot the significant hot spot and cold spot areas</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="performing-emerging-hotspot-analysis" class="level1">
<h1>Performing Emerging Hotspot Analysis</h1>
<section id="creating-a-time-series-cube" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-time-series-cube">Creating a Time series cube</h2>
<p>Filering to the columns for time series</p>
<p>Convert the data frame to tibble</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="mann-kendall-test" class="level2">
<h2 class="anchored" data-anchor-id="mann-kendall-test">Mann-Kendall Test</h2>
<p>First, define a function that takes a VILLCODE as an argument and generates the plot for that VILLCODE:</p>
<p>call this function with the VILLCODE:</p>
<div class="cell">
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-e2ecedf8c1e4e9e0fe9e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-e2ecedf8c1e4e9e0fe9e">{"x":{"data":[{"x":[31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],"y":[-0.50216442578360321,-1.1806520050840903,-1.4501806591125181,-1.039450247717095,-1.459685849564619,-1.7891355919676957,-1.6587338446563735,-1.1815179994243794,-0.53480366118858602,0.12286891765831108,-1.1540762498790433,-0.25961100586697067,-1.4106321320042634,-0.0089123945718893125,0.94350410639371096,1.7101141060360523,0.041212060174089064,1.9097854059674699,3.698348879083019,0.38392036446479527],"text":["epi_week_number: 31<br />gi_star: -0.502164426","epi_week_number: 32<br />gi_star: -1.180652005","epi_week_number: 33<br />gi_star: -1.450180659","epi_week_number: 34<br />gi_star: -1.039450248","epi_week_number: 35<br />gi_star: -1.459685850","epi_week_number: 36<br />gi_star: -1.789135592","epi_week_number: 37<br />gi_star: -1.658733845","epi_week_number: 38<br />gi_star: -1.181517999","epi_week_number: 39<br />gi_star: -0.534803661","epi_week_number: 40<br />gi_star:  0.122868918","epi_week_number: 41<br />gi_star: -1.154076250","epi_week_number: 42<br />gi_star: -0.259611006","epi_week_number: 43<br />gi_star: -1.410632132","epi_week_number: 44<br />gi_star: -0.008912395","epi_week_number: 45<br />gi_star:  0.943504106","epi_week_number: 46<br />gi_star:  1.710114106","epi_week_number: 47<br />gi_star:  0.041212060","epi_week_number: 48<br />gi_star:  1.909785406","epi_week_number: 49<br />gi_star:  3.698348879","epi_week_number: 50<br />gi_star:  0.383920364"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":40.182648401826491,"l":37.260273972602747},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[30.050000000000001,50.950000000000003],"tickmode":"array","ticktext":["35","40","45","50"],"tickvals":[35,40,45,50],"categoryorder":"array","categoryarray":["35","40","45","50"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.6529680365296811,"tickwidth":0.33208800332088001,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088001,"zeroline":false,"anchor":"y","title":{"text":"epi_week_number","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-2.0635098155202316,3.9727231026355549],"tickmode":"array","ticktext":["-2","-1","0","1","2","3"],"tickvals":[-2,-1,0,1,2,3],"categoryorder":"array","categoryarray":["-2","-1","0","1","2","3"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.6529680365296811,"tickwidth":0.33208800332088001,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088001,"zeroline":false,"anchor":"x","title":{"text":"gi_star","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"69801603975":{"x":{},"y":{},"type":"scatter"}},"cur_data":"69801603975","visdat":{"69801603975":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-56ded1fcbf305623a1ac" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-56ded1fcbf305623a1ac">{"x":{"data":[{"x":[31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],"y":[4.0735657187212437,4.8081535985934893,3.5182124914872484,2.0347299275029114,1.2016717275414099,2.4099261235988667,1.4766438827843638,0.89918621879195593,1.4718177686271021,-0.024870301785805491,0.83628932436229142,1.1081850852319091,1.5157973892381911,0.33846405999291534,1.2149507506638373,0.1829791975069377,1.2438484526697893,0.54067360975712142,2.2960515509835617,0.26430740924293161],"text":["epi_week_number: 31<br />gi_star:  4.0735657","epi_week_number: 32<br />gi_star:  4.8081536","epi_week_number: 33<br />gi_star:  3.5182125","epi_week_number: 34<br />gi_star:  2.0347299","epi_week_number: 35<br />gi_star:  1.2016717","epi_week_number: 36<br />gi_star:  2.4099261","epi_week_number: 37<br />gi_star:  1.4766439","epi_week_number: 38<br />gi_star:  0.8991862","epi_week_number: 39<br />gi_star:  1.4718178","epi_week_number: 40<br />gi_star: -0.0248703","epi_week_number: 41<br />gi_star:  0.8362893","epi_week_number: 42<br />gi_star:  1.1081851","epi_week_number: 43<br />gi_star:  1.5157974","epi_week_number: 44<br />gi_star:  0.3384641","epi_week_number: 45<br />gi_star:  1.2149508","epi_week_number: 46<br />gi_star:  0.1829792","epi_week_number: 47<br />gi_star:  1.2438485","epi_week_number: 48<br />gi_star:  0.5406736","epi_week_number: 49<br />gi_star:  2.2960516","epi_week_number: 50<br />gi_star:  0.2643074"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":40.182648401826491,"l":31.415525114155255},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[30.050000000000001,50.950000000000003],"tickmode":"array","ticktext":["35","40","45","50"],"tickvals":[35,40,45,50],"categoryorder":"array","categoryarray":["35","40","45","50"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.6529680365296811,"tickwidth":0.33208800332088001,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088001,"zeroline":false,"anchor":"y","title":{"text":"epi_week_number","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.26652149680477022,5.0498047936124539],"tickmode":"array","ticktext":["0","1","2","3","4","5"],"tickvals":[0,1,2,3,4,5],"categoryorder":"array","categoryarray":["0","1","2","3","4","5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.6529680365296811,"tickwidth":0.33208800332088001,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088001,"zeroline":false,"anchor":"x","title":{"text":"gi_star","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"6980579d432a":{"x":{},"y":{},"type":"scatter"}},"cur_data":"6980579d432a","visdat":{"6980579d432a":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-0610e247e5c0adfbea84" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-0610e247e5c0adfbea84">{"x":{"data":[{"x":[31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],"y":[-0.76953858609621484,-1.0570155643917327,-1.0152492812208826,-1.1706937055030777,-1.4388702737432149,-1.5607552937558211,-1.594744260521413,-1.9090788518987165,-1.8095666589673136,-2.0956475476872658,-1.8771709936084202,-1.9852658586688157,-1.8843186240800549,-2.1526037004719116,-1.8380042642593513,-1.4809600441091031,-0.98621151043427602,-1.1426536232206619,-1.0281852645185667,0.26877677041112735],"text":["epi_week_number: 31<br />gi_star: -0.7695386","epi_week_number: 32<br />gi_star: -1.0570156","epi_week_number: 33<br />gi_star: -1.0152493","epi_week_number: 34<br />gi_star: -1.1706937","epi_week_number: 35<br />gi_star: -1.4388703","epi_week_number: 36<br />gi_star: -1.5607553","epi_week_number: 37<br />gi_star: -1.5947443","epi_week_number: 38<br />gi_star: -1.9090789","epi_week_number: 39<br />gi_star: -1.8095667","epi_week_number: 40<br />gi_star: -2.0956475","epi_week_number: 41<br />gi_star: -1.8771710","epi_week_number: 42<br />gi_star: -1.9852659","epi_week_number: 43<br />gi_star: -1.8843186","epi_week_number: 44<br />gi_star: -2.1526037","epi_week_number: 45<br />gi_star: -1.8380043","epi_week_number: 46<br />gi_star: -1.4809600","epi_week_number: 47<br />gi_star: -0.9862115","epi_week_number: 48<br />gi_star: -1.1426536","epi_week_number: 49<br />gi_star: -1.0281853","epi_week_number: 50<br />gi_star:  0.2687768"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":40.182648401826491,"l":48.949771689497723},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[30.050000000000001,50.950000000000003],"tickmode":"array","ticktext":["35","40","45","50"],"tickvals":[35,40,45,50],"categoryorder":"array","categoryarray":["35","40","45","50"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.6529680365296811,"tickwidth":0.33208800332088001,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088001,"zeroline":false,"anchor":"y","title":{"text":"epi_week_number","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-2.2736727240160635,0.3898457939552793],"tickmode":"array","ticktext":["-2.0","-1.5","-1.0","-0.5","0.0"],"tickvals":[-2,-1.5,-1,-0.50000000000000022,0],"categoryorder":"array","categoryarray":["-2.0","-1.5","-1.0","-0.5","0.0"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.6529680365296811,"tickwidth":0.33208800332088001,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088001,"zeroline":false,"anchor":"x","title":{"text":"gi_star","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"6980513554de":{"x":{},"y":{},"type":"scatter"}},"cur_data":"6980513554de","visdat":{"6980513554de":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-ee62540afc6183ec2409" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ee62540afc6183ec2409">{"x":{"data":[{"x":[31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],"y":[-0.75297789398975801,-0.051456950178079504,0.52693964556770034,1.8515152753372499,0.62012639911968093,0.61466011772288298,0.62410512659365491,-0.64441642217206085,0.27898658786379743,-0.11109145872814276,-0.62420379306850948,-1.5710984134295389,-0.9351554591699649,-0.13274416335009395,-0.33839670991930393,-1.3624553869289009,-0.97353678776977637,-0.7130468757261369,-0.56292897584778323,-1.1798715992829802],"text":["epi_week_number: 31<br />gi_star: -0.75297789","epi_week_number: 32<br />gi_star: -0.05145695","epi_week_number: 33<br />gi_star:  0.52693965","epi_week_number: 34<br />gi_star:  1.85151528","epi_week_number: 35<br />gi_star:  0.62012640","epi_week_number: 36<br />gi_star:  0.61466012","epi_week_number: 37<br />gi_star:  0.62410513","epi_week_number: 38<br />gi_star: -0.64441642","epi_week_number: 39<br />gi_star:  0.27898659","epi_week_number: 40<br />gi_star: -0.11109146","epi_week_number: 41<br />gi_star: -0.62420379","epi_week_number: 42<br />gi_star: -1.57109841","epi_week_number: 43<br />gi_star: -0.93515546","epi_week_number: 44<br />gi_star: -0.13274416","epi_week_number: 45<br />gi_star: -0.33839671","epi_week_number: 46<br />gi_star: -1.36245539","epi_week_number: 47<br />gi_star: -0.97353679","epi_week_number: 48<br />gi_star: -0.71304688","epi_week_number: 49<br />gi_star: -0.56292898","epi_week_number: 50<br />gi_star: -1.17987160"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":40.182648401826491,"l":37.260273972602747},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[30.050000000000001,50.950000000000003],"tickmode":"array","ticktext":["35","40","45","50"],"tickvals":[35,40,45,50],"categoryorder":"array","categoryarray":["35","40","45","50"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.6529680365296811,"tickwidth":0.33208800332088001,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088001,"zeroline":false,"anchor":"y","title":{"text":"epi_week_number","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.7422290978678783,2.0226459597755895],"tickmode":"array","ticktext":["-1","0","1","2"],"tickvals":[-1,0,1,2],"categoryorder":"array","categoryarray":["-1","0","1","2"],"nticks":null,"ticks":"outside","tickcolor":"rgba(179,179,179,1)","ticklen":3.6529680365296811,"tickwidth":0.33208800332088001,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088001,"zeroline":false,"anchor":"x","title":{"text":"gi_star","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"69806c230fc":{"x":{},"y":{},"type":"scatter"}},"cur_data":"69806c230fc","visdat":{"69806c230fc":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Perform ESHA Analysis</p>
</section>
<section id="visualize-the-distribution-of-ehsa-classes" class="level2">
<h2 class="anchored" data-anchor-id="visualize-the-distribution-of-ehsa-classes">Visualize the distribution of EHSA classes:</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Join the datas</p>
<p>Filter the significant hotspots and store them in a variable</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="reflection" class="level1">
<h1>Reflection</h1>
<p>This task was tough and made me tired at first. Even though I faced many problems, I learned a lot. Throughout this assignment, I encountered numerous challenges that posed significant obstacles along the way. Despite the persistent errors and obstacles, I must acknowledge that this assignment has been a tremendous learning opportunity. While the journey was exhausting and marked by moments of wanting to give up due to repeated unsuccessful attempts, the fulfillment at the conclusion is deeply gratifying. Playing with different libraries and learning new things was fun. I am thankful and appreciative that I was ultimately able to complete the assignment.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>